---
export const prerender = false;

import { marked } from 'marked';
import BlogLayout from '../../layouts/BlogLayout.astro';
import { getPostBySlug, hasDatabaseUrl } from '../../lib/blog';

if (!hasDatabaseUrl()) return Astro.redirect('/');

const { slug } = Astro.params;
if (!slug) return Astro.redirect('/blog');

const post = await getPostBySlug(slug);
if (!post) return Astro.redirect('/blog');

const htmlContent = await marked(post.content);
---

<BlogLayout
  title={post.title}
  description={post.description}
  date={post.date}
  relatedTools={post.related_tools}
  ogImage={post.og_image ?? undefined}
>
  <Fragment set:html={htmlContent} />
</BlogLayout>
