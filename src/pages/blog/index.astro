---
export const prerender = false;

import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/layout/Header.astro';
import Footer from '../../components/layout/Footer.astro';
import { getAllPosts, hasDatabaseUrl } from '../../lib/blog';

if (!hasDatabaseUrl()) return Astro.redirect('/');

const posts = await getAllPosts();

const categoryLabels: Record<string, string> = {
  comparison: 'Comparisons',
  'use-case': 'How-To Guides',
  format: 'Format Guides',
  guide: 'Learn',
};

const grouped = Object.entries(categoryLabels).map(([key, label]) => ({
  key,
  label,
  posts: posts.filter((p) => p.category === key),
})).filter((g) => g.posts.length > 0);
---

<BaseLayout title="Blog - PrivaTools" description="Guides, comparisons, and tips for working with PDFs and images. Learn how to compress, convert, and optimize your files privately.">
  <Header />
  <main class="max-w-4xl mx-auto px-6 py-12 md:py-20">
    <div class="text-center mb-14">
      <h1 class="text-3xl md:text-4xl font-black text-slate-900 tracking-tight">Blog</h1>
      <p class="text-lg text-slate-500 mt-3 max-w-2xl mx-auto">Guides, comparisons, and tips for working with PDFs and images privately.</p>
    </div>

    {grouped.map(({ label, posts }) => (
      <section class="mb-14">
        <h2 class="text-2xl font-black text-slate-900 tracking-tight mb-6">{label}</h2>
        <div class="grid gap-4">
          {posts.map((post) => (
            <a href={`/blog/${post.slug}`} class="block bg-white rounded-2xl border-[3px] border-slate-900 shadow-[var(--shadow-brutalist-sm)] p-6 hover:shadow-[var(--shadow-brutalist-md)] hover:-translate-y-0.5 transition-all">
              <h3 class="font-black text-slate-900 text-lg">{post.title}</h3>
              <p class="text-slate-500 mt-1 text-sm">{post.description}</p>
              <time datetime={post.date} class="text-xs text-slate-400 mt-2 block">
                {new Date(post.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
              </time>
            </a>
          ))}
        </div>
      </section>
    ))}
  </main>
  <Footer />
</BaseLayout>
